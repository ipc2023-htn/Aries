Bootstrap: docker
From: ubuntu:22.04

%files
	## This copies all files in this repository into the container.
	## If you do so, please remove all files not needed to run the planner
	## (e.g. source-code, testing or debugging planning problems) from the container
	## to decrease its size as much as possible.
	# . /planner	

%setup
	## The "%setup"-part of this script is called to bootstrap an empty
	## container.

%post
	## The "%post"-part of this script is called after the container has
	## been created with the "%setup"-part above and runs "inside the
	## container". Most importantly, it is used to install dependencies
	## and build the planner. Add all commands that have to be executed
	## once before the planner runs in this part of the script.
	
	## Install all necessary dependencies.
	apt-get update
	apt-get -y install curl git build-essential 

	# Install Rust compiler
	curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh -s -- -y
	PATH="$HOME/.cargo/bin:$PATH"

	# Get aries sources
	git clone -b ipc-2023 https://github.com/plaans/aries.git aries
	
	## go to directory and make the planner
	cd aries
	cargo build --release --bin lcp
	cd ..

	# Save executable
	cp aries/target/release/lcp /aries-planner
	
	## remove files not needed to execute the planner
	rm -rf aries/
	rm -rf $HOME/.cargo
	apt-get -y purge curl git build-essential 
	apt-get -y autoremove
	apt-get -y clean

%runscript
	## The runscript is called whenever the container is used to solve
	## an instance.
	
	## DOMAINFILE and PROBLEMFILE contain the HDDL input files.
	DOMAINFILE=$1
	PROBLEMFILE=$2
	## PLANFILE is the name of the file to which your planner should write the plan it found.
	PLANFILE=$3

	## run your planner here
	exec /aries-planner $PROBLEMFILE --domain $DOMAINFILE --optimize plan-length --anytime --output $PLANFILE

## Update the following fields with meta data about your submission.
## Please use the same field names and use only one line for each value.
%labels
Name        Aries
Description 
Authors     Arthur Bit-Monnot <abitmonnot@laas.fr> and Roland Godet <rgodet@laas.fr>
SupportsRecursion yes
SupportsPartialOrder yes
SupportsOptimalPlanning no
SupportsUniversalPreconditions yes
